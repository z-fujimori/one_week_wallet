{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'expenses/css/index.css' %}">
    <!-- icon links -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
{% endblock %}

{% block content %}
{% load humanize %}
<!-- ^ 数字桁区切り -->
<div class="expenses-body">
    <div class="expend-form">
        <form action="{% url 'expenses:create_expense' %}" method="post">
            {% csrf_token %}
            <div class="form-header">
                <input class="input-date" type="date" value="{{ today }}" name="date"  required oninvalid="this.setCustomValidity('必須項目')"  oninput="this.setCustomValidity('')" >
            </div>
            <div class="form-body">
                <div class="input-main">
                    <div class="input-field">
                        <i class="fa-solid fa-tag input-icon"></i>
                        <input class="input-area" type="text" name="title" required oninvalid="this.setCustomValidity('必須項目')"  oninput="this.setCustomValidity('')">
                    </div>
                    <div class="input-field">
                        <i class="fa-solid fa-yen-sign input-icon"></i>
                        <input class="input-area" type="number" name="amount" required oninvalid="this.setCustomValidity('必須項目')"  oninput="this.setCustomValidity('')" >
                    </div>
                </div>
                <div class="form-button">
                    <div class="form-button-spacer"></div>
                    <button type="submit" class="pen-button"><i class="fa-solid fa-pen"></i></button>
                </div>
            </div>
        </form>
    </div>

    <hr>

    <div class="week-calender">
        <table border="1" class="week-calender-table" style="border-collapse: collapse; overflow: hidden;" >
            <tr class="week-calender-title">
                {% for date, week_day, total in daily_amount_total %}
                    <th onclick="openModal('{{date}}')">
                        <div style="font-size: 12px;">{{ date }}</div>
                        <div style="font-size: 19px;">{{ week_day }}</div>
                    </th>
                {% empty %}
                    <td colspan="8">データがありません。</td>
                {% endfor %}
            </tr>
            <tr class="week-calender-value">
                {% for date, week_day, total in daily_amount_total %}
                    <!-- <td>{{ date }}</td> -->
                    <td  style="width: 100px;" onclick="openModal('{{date}}')">
                        {{ total | intcomma }}円
                    </td>
                {% empty %}
                    <td colspan="8">データがありません。</td>
                {% endfor %}
            </tr>
        </table>
    </div>


    <!-- <hr>
    <table>
        <thead>
            <tr>
                <th>日付</th>
                <th>タイトル</th>
                <th>金額</th>
                <th>タグ</th>
            </tr>
        </thead>
        <tbody>
            {% for expense in expenses %}
                <tr>
                    <td>{{ expense.date }}</td>
                    <td>{{ expense.title }}</td>
                    <td>{{ expense.amount }}円</td>
                    <td>{{ expense.tag.name }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4">データがありません。</td>
                </tr>
            {% endfor %}
        </tbody>
    </table> -->

    <div class="control">
        <div class="control-return"><button><</button></div>
        <div class="control-title"> 〜 </div>
        <div class="control-improve"><button>></button></div>
    </div>

    <!-- モーダル -->
    <div id="myModal" class="modal hidden"  >
        <div class="modal-content" id="modalContent">
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById("myModal");
    const modalContent = document.getElementById("modalContent");
    const closeBtn = document.querySelector(".close-button");

    // モーダルを開く関数
    function openModal(date) {
        if (date=="") { return }
        console.log(date)
        modalContent.innerHTML = `
            <div>
                <button class="close-button" onclick="cleseModal()">x</button>
            </div>
        `;

        // 閉じるボタンを再バインド
        // modalContent.querySelector(".close-button").addEventListener("click", closeModal);
        modal.classList.remove("hidden");
    }

    function cleseModal() {
        modal.classList.add("hidden");
    }

    // 閉じる
    modal.addEventListener("click", () => {
        modal.classList.add("hidden");
    });
    modalContent.addEventListener("click", (e) => {
        // 親要素にイベントが伝播しないようにする
        e.stopPropagation();
    });

    // closeBtn.addEventListener("click", () => {
    //     modal.classList.add("hidden");
    // });


    // // 背景クリックで閉じる
    // window.addEventListener("click", (e) => {
    //     if (e.target === modal) {
    //         modal.classList.add("hidden");
    //     }
    // });
</script>
{% endblock %}